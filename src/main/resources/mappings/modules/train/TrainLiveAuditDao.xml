<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.training.modules.train.dao.TrainLiveAuditDao">
	<sql id="sqlColumns">
		a.id,
		a.userId,
		b.`name` as "userName",
		b.remarks,
		a.title,
		a.name,
		a.desc,
		a.bengtime,
		a.endtime,
		a.templatetype,
		a.authtype,
		a.publisherpass,
		a.playpass,
		a.checkurl,
		a.barrage,
		a.foreignpublish,
		a.openlowdelaymode,
		a.showusercount,
		a.audit_status,
		a.create_date,
		a.audit_user,
		a.imgurl,
		a.live_remarks,
		r.roomId as "roomId",
		a.del_flag

	</sql>

	<!-- 根据编号获特长 -->
	<select id="get" resultType="TrainLiveAudit">
		SELECT
		<include refid="sqlColumns" />
		FROM trains.train_live_audit a 
		LEFT JOIN sys_user b ON a.userId=b.id
		LEFT JOIN train_live_room r ON r.userId=a.userId
		WHERE a.del_flag=0 and a.id=#{id}

	</select>


	<!-- 分页查询 -->
	<select id="findList" resultType="TrainLiveAudit">
		SELECT
		<include refid="sqlColumns" />
		FROM trains.train_live_audit a 
		LEFT JOIN sys_user b ON a.userId=b.id
		LEFT JOIN train_live_room r ON r.userId=a.userId
		WHERE a.del_flag=0
		<if test="userName!=null and userName!=''">
			AND b.name like
			<if test="dbName == 'oracle'">'%'||#{userName}||'%'</if>
			<if test="dbName == 'mysql'">CONCAT('%',#{userName}, '%')</if>
		</if>
		<if test="title!=null and title!=''">
			AND a.title like
			<if test="dbName == 'oracle'">'%'||#{title}||'%'</if>
			<if test="dbName == 'mysql'">CONCAT('%',#{title}, '%')</if>
		</if>
		<if test="auditStatus!=null and auditStatus!=''">
			AND a.audit_status=#{auditStatus}
		</if>

		ORDER BY a.create_date DESC

	</select>
	<!-- 更新数据 -->
	<update id="update">
		UPDATE train_live_audit SET
		audit_status=#{auditStatus},
		live_remarks=#{liveRemarks},
		audit_user=#{auditUser}
		WHERE id=#{id}
	</update>
	<!-- 审核直播 -->
	<update id="updateLiveLiveAudit">
		UPDATE 
			train_live_audit 
		SET 
			audit_status = 0,
			live_remarks = '审核未通过',
			audit_user = '超管'
		WHERE 
			audit_status = 1 AND bengTime <![CDATA[ <= ]]> SYSDATE()
	</update>
</mapper>